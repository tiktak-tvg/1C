
Процедура ПриЗаписи(Отказ)
	Запрос = Новый Запрос;
	Запрос.Текст =
		"ВЫБРАТЬ
		|	ПланСчетов.Ссылка,
		|	ПланСчетов.Наименование
		|ИЗ
		|	ПланСчетов.Бухгалтерский КАК ПланСчетов
		|ГДЕ
		|	НЕ ПланСчетов.Забалансовый
		|	И ПланСчетов.ВидыСубконто.ВидСубконто = ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконто.Номенклатура)
		|	И (&УчетПоСкладам
		|			ИЛИ ПланСчетов.ВидыСубконто.ВидСубконто = ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконто.Склады))";
	Запрос.УстановитьПараметр("УчетПоСкладам", Константы.УчетПоСкладам.Получить());
	Результат = Запрос.Выполнить();
	Выборка = Результат.Выбрать();
	
	Пока Выборка.Следующий() Цикл
		СчетСсылка = Выборка.Ссылка;
		Попытка
			ЗаблокироватьДанныеДляРедактирования(СчетСсылка);
			СчетОбъект = СчетСсылка.ПолучитьОбъект();
			ВидыСубконтоСчета = СчетОбъект.ВидыСубконто;
			СтрокаВидыСубконтоСклад = ВидыСубконтоСчета.Найти(ПланыВидовХарактеристик.ВидыСубконто.Склады, "ВидСубконто");
			Если СтрокаВидыСубконтоСклад = Неопределено И ВидыСубконтоСчета.Количество() < 2 Тогда
				СтрокаВидыСубконтоСклад = ВидыСубконтоСчета.Добавить();
				СтрокаВидыСубконтоСклад.ВидСубконто = ПланыВидовХарактеристик.ВидыСубконто.Склады;
			ИначеЕсли НЕ Константы.УчетПоСкладам.Получить() Тогда
				ВидыСубконтоСчета.Удалить(СтрокаВидыСубконтоСклад);
			КонецЕсли;
			СчетОбъект.Записать();
		Исключение
			Сообщение = Новый СообщениеПользователю;
			Сообщение.Текст = "Не удалось изменить аналитику счета" + Выборка.Наименование;
			Сообщение.Сообщить();
		КонецПопытки;
	КонецЦикла;
КонецПроцедуры